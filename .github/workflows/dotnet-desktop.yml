name: Build e Testes (Final)

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build:
    runs-on: windows-latest  # Windows é obrigatório para o teu projeto antigo (.NET Framework)

    steps:
    - name: Check out do código
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Configurar .NET 8 (Para os Testes)
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    - name: Configurar MSBuild (Compilador)
      uses: microsoft/setup-msbuild@v2

    - name: Restaurar Dependências
      # O comando dotnet restore é inteligente e resolve tanto o projeto antigo como o novo
      run: dotnet restore trabalhoPOO_33222.sln

    - name: Compilar Projeto (Build)
      # Compila a solução inteira
      run: msbuild trabalhoPOO_33222.sln /p:Configuration=Debug /p:Platform="Any CPU"

    - name: Executar Testes Unitários
      # Corre apenas o projeto de testes, sem tentar recompilar (no-build)
      run: dotnet test GestaoCondominios.Tests/GestaoCondominios.Tests.csproj --no-build --verbosity normal
